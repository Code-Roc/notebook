<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="stylesheet" href="assets/css/style.css">
    <title>notebook by zjuchenyuan</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>notebook</h1>
        <h2>我的技术笔记本~</h2>

        <section id="downloads">
          
          <a href="http://github.com/zjuchenyuan/notebook" class="btn btn-github"><span class="icon"></span>View on GitHub</a>&nbsp;<a href="https://py3.io" class="btn btn-back"><span class="icon"></span>Back to Index</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1 id="struts2s2-045">修复Struts2的S2-045漏洞</h1>

<h2 id="exp">exp</h2>

<p>首先丢个exp，用于检验漏洞存在性：<a href="code/exp.S2-045.py">exp.S2-045.py</a></p>

<p>使用方法示例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>python exp.S2-045.py http://example.com/example.action "id"
</code></pre>
</div>

<hr />

<h2 id="section">解决过程</h2>

<p>翻遍了官网和各种新闻，没有切实可行的方案，下载地址只有存在漏洞的2.3.31的版本，漏洞修复方案都是简略的一句升级到2.3.32，某些播报平台&amp;官方真是mdzz，到底是为了促进漏洞修补还是促进全网被黑？</p>

<p>官方只是给了一个maven的配置方法，并没有直接可以下载的jar文件或zip包</p>

<p>只能按照官方的方法用maven去尝试构建一个struts应用(快速装好maven的方法是买个香港的vps用docker pull maven)，总算发现了新版的jar包下载地址：</p>

<p><a href="https://repo.maven.apache.org/maven2/org/apache/struts/">https://repo.maven.apache.org/maven2/org/apache/struts/</a></p>

<p>通过下载2.3.31核心包发现只有<code class="highlighter-rouge">struts2-core</code>是需要的。</p>

<hr />

<h2 id="x">2.3.x版本修复方法</h2>

<p>下载2.3.32版本的jar文件</p>

<p><a href="https://repo.maven.apache.org/maven2/org/apache/struts/struts2-core/2.3.32/struts2-core-2.3.32.jar">https://repo.maven.apache.org/maven2/org/apache/struts/struts2-core/2.3.32/struts2-core-2.3.32.jar</a></p>

<p>国内CDN下载地址: <a href="https://d.py3.io/struts2-core-2.3.32.jar">https://d.py3.io/struts2-core-2.3.32.jar</a></p>

<p>假设服务器上用的是2.3.30版本，则<code class="highlighter-rouge">tomcat所在目录/webapps/应用名称/WEB-INF/lib</code>里面有一个<code class="highlighter-rouge">struts2-core-2.3.30.jar</code></p>

<p>修复方法就是①把上述文件删掉，②下载到的新版jar文件改名为同名文件，③上传替换，④重启tomcat即可</p>

<p>Tip: 替换后要保证旧版的jar文件不存在，例如移到上一级目录，不要把旧版本的jar改名留在lib目录下，否则将导致这个webapp无法启动</p>

<h2 id="x-1">2.5.x版本修复方法</h2>

<p>下载2.5.10.1版本的jar文件</p>

<p><a href="https://repo.maven.apache.org/maven2/org/apache/struts/struts2-core/2.5.10.1/struts2-core-2.5.10.1.jar">https://repo.maven.apache.org/maven2/org/apache/struts/struts2-core/2.5.10.1/struts2-core-2.5.10.1.jar</a></p>

<p>国内CDN下载地址：<a href="https://d.py3.io/struts2-core-2.5.10.1.jar">https://d.py3.io/struts2-core-2.5.10.1.jar</a></p>

<p>假设服务器上用的是2.5.10版本，则<code class="highlighter-rouge">tomcat所在目录/webapps/应用名称/WEB-INF/lib</code>里面有一个<code class="highlighter-rouge">struts2-core-2.5.10.jar</code></p>

<p>修复方法同上</p>

<hr />

<p>期待一个更负责任的漏洞披露过程，期待一个更加安全的互联网</p>

<p>Author: zjuchenyuan</p>

<p>Source: <a href="https://py3.io/S2-045.html">https://py3.io/S2-045.html</a></p>

      </section>
    </div>

    
  </body>
<script src="https://py3.io/assets/instantclick.min.js"></script><script data-no-instant>InstantClick.init();</script></html>
